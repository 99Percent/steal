// usage: steal\js -mail <%= path %>\scripts\test_and_email.js

if (typeof javax.mail.Session.getDefaultInstance != "function") {
	print('usage: steal\\js -mail <%= path %>\\scripts\\test_and_email.js')
	quit()
}

load('<%= path %>/test/settings.js')
load('steal/email/email.js');

if (java.lang.System.getProperty("os.name").indexOf("Windows") != -1) {
	runCommand("cmd", "/C", "start /b steal\\js <%= path %>/scripts/funcunit.js > <%= path %>/test.log")
	runCommand("cmd", "/C", "start /b steal\\js <%= path %>/scripts/qunit.js >> <%= path %>/test.log")
}
else {
	runCommand("sh", "-c", "nohup ./steal/js <%= path %>/scripts/funcunit.js > <%= path %>/test.log")
	runCommand("sh", "-c", "nohup ./steal/js <%= path %>/scripts/qunit.js >> <%= path %>/test.log")
}

var log = readFile('<%= path %>/test.log');
Emailer.setup(EmailerDefaults);
Emailer.send(log)